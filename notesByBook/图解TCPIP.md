# 图解TCP|IP

## 第一章、网络基础知识

### 1.1、OSI参考模型

![preview](https://pic1.zhimg.com/v2-f0d1c53bce5f241223560b04c6077fc0_r.jpg)

1. 应用层

   主要用于打包发送消息，发送内容+收件人地址+发件人等信息

2. 表示层

   主要用于协商数据交换格式，将数据转换为网络通用的标准数据格式再进行传输，如：UTF-8、GBK、ISO-8859

3. 会话层

   采用某种方法传输数据

传输层以上并不具有实际传输数据的功能，真正负责在网络上传输具体数据的是会话层以下的这些服务层

4. 传输层

   确立连接与断开连接、重发，用于建立会话(三次握手)、保持会话(设定会话没有通信则自动断开时间)，断开连接(四次挥手)

5. 网络层

   从主机A到主机B的数据通信处理，路由选择，流量控制，IP地址，形成IP包

6. 数据链路层

   通信传输实际上是通过芜劣传输介质实现的，数据链路层的作用就是在这些通过传输介质互连的设备之间进行数据处理，成帧，保证帧的无误传输，MAC地址，形成EHTHERNET帧

7. 物理层

   物理接口规范，传输比特流

形象比喻

1. 应用层：A公司经理把他想要告诉B公司经理的事说出来
2. 表示层：秘书把A公司经理说的事情翻译成英文写到纸上
3. 会话层：行政职员把秘书写的这封信装到了信封封号，写上了信封的信息
4. 传输层：A邮局的职工把这封信取走
5. 网络层：A邮局分派的职工，把这封信分派到指定的送信区域
6. 数据链路层：A邮局的装箱职工，把送往同一区域的信封装到了木箱里
7. A邮局的物流职工把木箱运到了铁路

### 1.2、传输方式的分类

#### 1.2.1、面向有连接型与面向无连接型

- 面向有连接型：在发送数据之前，需要在收发主机之间连接一条通信线路
- 面向无连接型：面向无连接型不要求建立和断开连接。发送端可于任何时候自由发送数据，但接收端也永远不知道自己会在何时从哪里收到数据，因此，在面向无连接的情况下，接收端需要时长确认是否收到了数据

#### 1.2.2、电路交换与分组交换

- 电路交换：交换机主要负责数据的中转处理。计算机首先被连接到交换机上，而交换机与交换机之间则由众多通信线路在继续连接。因此计算机之间在发送数据时，需要通过交换机与目标主机建立通信线路再继续连接。建立好连接以后，用户就可以一直使用这条电路，直到该连接呗断开为止
- 分组交换：让连接到通信电路的计算机所要发送的数据分成多个数据包，按照一定的顺序排列之后分别发送。
  有了分组交换，数据被细分后，所有即使在分组的过程中，已经在每组的首部写入了发送端和接收端地址，所以即使同一条线路同时为多个用户提供服务，也可以明确区分每组数据发往的目的地，以及它是与哪台计算机进行的通信

![image-20210729181011340](C:\Users\black\AppData\Roaming\Typora\typora-user-images\image-20210729181011340.png)

电路交换与分组交换区别：

- 电路交换最多只能有两个用户同时通信，但是连接后可以随时通讯，并且连接稳定。
- 分组交换，通讯线路的速度可能会有所不同，根据网络拥堵的情况，数据达到目标地址的时间有长有短。另外，路由器的缓存饱和或溢出时，甚至可能会发生分组数据丢失、无法发送到对端的情况

#### 1.2.3、根据接收端数量分类

- 单播(Unicast)：一对一通信，最早的固定电话就是单播

- 广播(Broadcast)：将消息从一台主机发送给与之相连的所有其他主机，比如广播电台与收音机

  每个广播电台都有自己的频段，只有在相应频段的可接收范围内才能收到电视信号。与之类似的进行广播通信的计算机也有广播范围，这个范围叫做广播域

- 多播(Multicast)：多播与广播类似，不同之处在于多播要限定某一组主机作为接收端，比如视频会议

- 任播(Anycast)：特定的多台主机中选出一台作为接收端的通信方式，与多播有很多相似之处，但是传播行为上是不同的，任播通信从目标主机群中选择一台最符合网络条件的主机作为目标主机发送消息

### 1.3、地址

#### 1.3.1、地址的唯一性

如果想让地址在通信当中发挥作用，首先需要确定通信的主体。一个地址必须明确地表示一个主体对象。在同一个通信网络中不允许有两个相同地址的通信主体存在

单播很好理解，一个地址对应一个主机

多播就需要对应一组主机地址，举个例子，老师说：“一年一班的同学们起立”其中，“一年一班”实际上就是多播的目标地址，具有唯一性

再比如任播,老师说：“一年一班的哪一个同学来一下”，“一年一班任意一位同学”就成了此次目标地址

#### 1.3.2、地址的层次性

正如送信地址要分为国名-省名-市名和区名，网络地址也要有这些层次才能更快地定位某一个地址

MAC地址和IP地址在标识一个通信主体时虽然都具有唯一性，但是它们当中只有IP地址具有层次性。

MAC地址是由设备的制造厂商针对每块网卡进行分别指定的。

IP地址由网络号和主机号两部分组成。即使通信主体的IP地址不同，若主机号不同，网络号相同，说明他们处于同一网段。

网络传输中，每个节点会根据分组数据的地址信息，来判断该报文应该由哪个网卡发出去。为此，各个地址会参考一个发出接口列表。在这一点上MAC寻址与IP寻址是一样的。只不过MAC寻址中所参考的这张表叫做地址转发表，而IP寻址中所参考的叫做路由控制表。MAC地址转发表中所记录的是实际的MAC地址本身，而路由表中记录的IP地址则是集中了之后的网络号。

![image-20210730175839160](C:\Users\black\AppData\Roaming\Typora\typora-user-images\image-20210730175839160.png)

### 1.4、网络的构成要素

![image-20210731085956566](C:\Users\black\AppData\Roaming\Typora\typora-user-images\image-20210731085956566.png)

1. 网卡：使计算机连网的设备(Network Interface)
2. 中继器(Repeater)：从物理层上延长网络的设备
3. 网桥(Bridge)/2层交换机：从数据链路层上延长网络的设备
4. 路由器(Router)/3层交换机：通过网络层转发分组数据的设备
5. 4-7层交换机：数据传输层以上各层网络传输的设备
6. 网关(Gateway)：转换协议的设备

#### 1.4.1、通信媒介与数据链路

![image-20210731094239719](C:\Users\black\AppData\Roaming\Typora\typora-user-images\image-20210731094239719.png)

传输速率与吞吐量

在数据传输的过程中，两个设备之间数据流动的物理速度称为传输速率。单位为bps(Bits Per Second，每秒比特数)，传输速率又称作带宽(Bandwidth)

主机之间实际的传输速率被称作吞吐量，单位bps。吞吐量不仅衡量带宽，同时也衡量主机的CPU处理能力、网络的拥堵程度、报文中数据字段的占有份额(不含报文首部，只计算数据字段本身)等信息。

#### 1.4.2、网卡

任何一台计算机连接网络时，必须要使用网卡(网络接口卡)，也称网络适配器、网卡、LAN卡。

#### 1.4.3、中继器

中继器(Repeater)是在OSI模型的第一层 -- 物理层面上延长网络的设备。由电缆传过来的电信号或光信号经由中继器的波形调整和放大再传给另一个电缆。

![image-20210802092652427](C:\Users\black\AppData\Roaming\Typora\typora-user-images\image-20210802092652427.png)

中继器也可以完成不同媒介之间的转换工作。

通过中继器而进行的网络延长，其距离并非可以无限扩大。如：10Mps的以太网最多可以用4个中继器分段连接，而一个100Mps的以太网则最多只能连两个中继器。

有些中继器也可以提供多个端口服务。这种中继器被称为中继集线器或集线器

![image-20210802093901696](C:\Users\black\AppData\Roaming\Typora\typora-user-images\image-20210802093901696.png)

#### 1.4.4、网桥/2层交换机

![image-20210802094147120](C:\Users\black\AppData\Roaming\Typora\typora-user-images\image-20210802094147120.png)

网桥是在OSI模型的第二层 -- 数据链路层面上连接两个网络的设备。它能够识别数据链路层中的数据帧，并将这些数据帧临时存储于内存，再重新生成信号作为一个全新的帧转发给相连的另一个网段。由于能够存储这些数据帧，网桥能够连接10BASE-T与100BASE-TX等传输速率完全不同的数据链路，并且不限制连续网段的个数。

数据链路的数据帧中有一个数据位叫做FCS，用以校验数据是否正确送达目的地。网桥通过检查这个城中的值，将那些损坏的数据丢弃，从而避免发送给其他的网段，此外，网桥还能通过地址自学机制和过滤功能控制网络流量。

![image-20210802134834269](C:\Users\black\AppData\Roaming\Typora\typora-user-images\image-20210802134834269.png)

以太网等网络中经常使用的交换集线器(Hub)，现在基本也属于网桥的一种

#### 1.4.5、路由器/3层交换机

![image-20210802140017875](C:\Users\black\AppData\Roaming\Typora\typora-user-images\image-20210802140017875.png)

路由器是在OSI模型的第3层 -- 网络层面上链接两个网络、并对分组报文进行转发的设备。网桥是根据物理地址进行处理，而路由器/3层交换机则是根据IP地址进行处理的。由此，TCP/IP中网络层的地址就成为了IP地址。

路由器可以连接不同的数据链路。例如：连接两个以太网，或者连接一个以太网与一个FDDI。

路由器还分担网络负荷的作用，甚至有些路由器具备一定的网络安全功能。

#### 1.4.6、4~7层交换机

![image-20210802160945156](C:\Users\black\AppData\Roaming\Typora\typora-user-images\image-20210802160945156.png)

4~7层交换机负责处理OSI模型中从传输层至应用层的数据。如果用TCP/IP分层模型来表述，4~7层交换机就是以TCP等协议的传输层及其上面的应用层为基础，分析收发数据，并对其进行特定的处理

负载均衡器是4~7层交换机的一种。

4~7层交换机功能：

- 负载均衡
- 带宽控制
- 广域网加速器
- 特殊应用访问加速
- 防火墙

#### 1.4.7、网关

![image-20210802165620933](C:\Users\black\AppData\Roaming\Typora\typora-user-images\image-20210802165620933.png)

网关是OSI参考模型中负责将从传输层到应用层的数据进行转换和转发的设备。它与4~7层交换机一样都是处理传输层以上的数据，但是网关不仅转发数据还负责对数据进行转换，它通常会使用一个表示层或应用层网关，在两个不能进行直接通信的协议之间进行翻译。

![image-20210802170757918](C:\Users\black\AppData\Roaming\Typora\typora-user-images\image-20210802170757918.png)

代理服务器(Proxy Server)：又称应用网关，用于流量控制和信息监控

防火墙也是一种网关

![image-20210802171756320](C:\Users\black\AppData\Roaming\Typora\typora-user-images\image-20210802171756320.png)

![image-20210802171802800](C:\Users\black\AppData\Roaming\Typora\typora-user-images\image-20210802171802800.png)

## 第二章、TCP/IP基础

![image-20210803092628676](C:\Users\black\AppData\Roaming\Typora\typora-user-images\image-20210803092628676.png)

### 2.1、TCP/IP出现的背景及其历史

#### 2.1.1、从军用技术的应用谈起

20世纪60年代，一家以美国国防部(DoD,The Department of Defense)为中心的组织，想到即使遭到敌方攻击，也可以经过迂回线路实现最终通信

随后分组交换技术提出，它可以使多个用户同一时间共享一条通信线路进行通信，从而提高线路的使用效率，也降低了搭建线路的成本

![image-20210803110627724](C:\Users\black\AppData\Roaming\Typora\typora-user-images\image-20210803110627724.png)

![image-20210803110718486](C:\Users\black\AppData\Roaming\Typora\typora-user-images\image-20210803110718486.png)

#### 2.1.2、ARPANET的诞生

1969年，为验证分组交换技术的实用性，研究人员搭建了一套网络。在美国西海岸的大学和研究所等4个节点(UCLA（加州大学洛杉矶分校）、UCSB（加州大学圣巴巴拉分校）、SRI（斯坦福研究所）和犹他州大学)

这个网络被称为ARPANET(Advanced Research Projects Agency Network,阿帕网)，也是全球互联网的鼻祖。

#### 2.1.3、TCP/IP的诞生

20世纪70年代前半叶，ARPANET中的一个研究机构研发出了TCP/IP。直到1982年，TCP/IP的具体规范才被最终定下来，并与1983年成为ARPANET网络唯一指定的协议

![image-20210803113233988](C:\Users\black\AppData\Roaming\Typora\typora-user-images\image-20210803113233988.png)

#### 2.1.4、UNIX系统的普及与互联网的扩张

1980年左右，ARPANET中的很多大学与研究机构开始使用一种叫做BSD UNIX(由美国加州大学伯克利分校开发的免费UNIX系统)的操作系统，由于BSD UNIX实现了TCP/IP协议，很快在1983年，TCP/IP便被ARPANET正式采用。同年，前SUN公司也开始向一般用户提供实现了TCP/IP的产品。

20世纪80年代，ARPANET连接到NSFnet网络，基于TCP/IP而形成的世界性范围的网络 -- 互联网(The Internet)便诞生了

#### 2.1.5、商用互联网服务的启蒙

1990年逐渐被引入公司企业及一般家庭。也出现了ISP(Internet Service Provider)互联网服务提供商

### 2.2、TCP/IP的标准化

20世纪90年代，ISO开展了OSI这一国际标准化进程。然而，OSI协议并没有得到普及，真正被广泛使用的是TCP/IP协议

#### 2.2.1、TCP/IP的具体含义

TCP/IP是利用IP进行通信时所必须用到的协议群的统称。IP或ICMP、TCP或UDP、TELNET或FTP、以及HTTP等都属于TCP/IP的协议，有时TCP/IP也称为网络协议群

![image-20210803161621218](C:\Users\black\AppData\Roaming\Typora\typora-user-images\image-20210803161621218.png)

#### 2.2.2、TCP/IP标准化精髓





































































